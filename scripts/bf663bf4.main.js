"use strict";Parse.initialize("fAAOcX6ymK5Y6cAxJm9SuWKueNwRuNg9a9yL9chU","Rp7YkpFZqOV7jItJsut7vuDUBXO2GUPrWwkMTZr2"),$(".sign-out-menu-link").click(function(){Parse.User.logOut();Parse.User.current()});var checkNav=function(){if(Parse.User.current()){var a=_.template($(".signed-in-header-view-template").text());$(".header-link-logged-in").html(a());var a=_.template($(".write-header-view-template").text());$(".write-header-view").html(a()),$(".sign-out-menu-link").click(function(){Parse.User.logOut();Parse.User.current();router.navigate("/#",{trigger:!0})})}else{var a=_.template($(".sign-up-header-view-template").text());$(".header-link-logged-in").html(a())}},Article=Parse.Object.extend({className:"Article",defaults:{postTitle:"",postContent:"",postContentEditor:""}}),Articles=Parse.Collection.extend({model:Article}),HomeView=Parse.View.extend({className:"home-page",template:_.template($(".home-page-view-template").text()),events:{},initialize:function(){$(".content-container").html(this.el),this.render()},render:function(){return this.$el.html(this.template()),this}}),SignUpView=Parse.View.extend({className:"sign-up-page",template:_.template($(".sign-up-page-view-template").text()),events:{"click .sign-up-button":"signUp"},initialize:function(){$(".content-container").html(this.el),this.render()},render:function(){return this.$el.html(this.template()),this},signUp:function(){var a=new Parse.User;a.set("username",$(".sign-up-username-input").val()),a.set("password",$(".sign-up-password-input").val()),a.set("email",$(".sign-up-email-input").val()),a.signUp(null,{success:function(){router.navigate("#profile",{trigger:!0})},error:function(a,b){alert("Error: "+b.code+" "+b.message)}})}}),SignInView=Parse.View.extend({className:"sign-in-page",template:_.template($(".sign-in-page-view-template").text()),events:{"click .sign-in-button":"signIn"},initialize:function(){$(".content-container").html(this.el),this.render()},render:function(){return this.$el.html(this.template()),this},signIn:function(){Parse.User.logIn($(".sign-in-username-input").val(),$(".sign-in-password-input").val(),{success:function(){router.navigate("#thumbnail",{trigger:!0});var a=Parse.User.current().attributes.username;console.log("Welcome, "+a)},error:function(){alert("There was an error signing in. Please try again.")}})}}),PasswordView=Parse.View.extend({className:"password-page",template:_.template($(".password-page-view-template").text()),events:{"click .password-page-button":"passwordReset"},initialize:function(){$(".content-container").html(this.el),this.render()},render:function(){return this.$el.html(this.template()),this},passwordReset:function(){var a=$(".password-input").val();Parse.User.requestPasswordReset(a,{success:function(){alert("Password was sent successfully")},error:function(a){alert("Error: "+a.code+" "+a.message)}})}}),SettingsView=Parse.View.extend({className:"settings-page",template:_.template($(".settings-page-view-template").text()),events:{"click .settings-save-button":"updateUserInfo"},initialize:function(){$(".content-container").html(this.el),this.render()},render:function(){return console.log("user is ",Parse.User.current()),this.$el.html(this.template()),this},updateUserInfo:function(){function a(a,c,d,e){var f=$.Deferred();if(!d)var d=function(){};if(!e)var e=function(a,b){alert("Error: "+b.code+" "+b.message)};if(a.files.length>0){var g=a.files[0],h="photo.jpg",i=new Parse.File(h,g);i.save().then(function(){b.set(c,i),console.log("The file has been saved to Parse."),b.save(null,{success:d,error:e}).done(function(){f.resolve()})},function(){alert("The file either could not be read, or could not be saved to Parse.")})}else b.save(null,{success:d,error:e}).done(function(){f.resolve()});return f}var b=Parse.User.current();b.set("name",$(".settings-name-input").val()),b.set("gender",$(".settings-gender-input:checked").val()),b.set("birthday",$(".settings-birthday-input").val()),b.set("website",$(".settings-website-input").val()),b.set("contactEmail",$(".settings-contact-email-input").val()),b.set("email",$(".settings-email-input").val()),b.set("about",$(".settings-about-you-input").val());var c=a($(".profile-banner-file-upload")[0],"bannerPicture"),d=a($(".profile-photo-file-upload")[0],"profilePicture",function(){});c.done(function(){d.done(function(){router.navigate("#profile",{trigger:!0})})})}}),PostView=Parse.View.extend({className:"post-page",template:_.template($(".post-page-view-template").text()),events:{"click .post-page-button":"postArticle"},initialize:function(){$(".content-container").html(this.el),this.render()},render:function(){return this.$el.html(this.template()),this},postArticle:function(){var a=Parse.User.current(),b=Parse.Object.extend("Article"),c=new b;c.set("postTitle",$(".post-title-input").val()),c.set("postContent",$(".post-content-input").val()),c.set("user",a),c.save(null,{success:function(){}});var d=$(".post-file-upload")[0];if(d.files.length>0){var e=d.files[0],f="photo.jpg",g=new Parse.File(f,e);g.save().then(function(){c.set("postPicture",g),console.log("The file has been saved to Parse."),c.save(null,{success:function(){router.navigate("#profile",{trigger:!0})},error:function(a,b){alert("Error: "+b.code+" "+b.message)}})},function(){console.log("The file either could not be read, or could not be saved to Parse.")})}else c.save(null,{success:function(){router.navigate("#profile",{trigger:!0})},error:function(a,b){alert("Error: "+b.code+" "+b.message)}})}}),ThumbnailView=Parse.View.extend({className:"thumbnail-page",template:_.template($(".thumbnail-page-view-template").text()),events:{},initialize:function(){$(".content-container").html(this.el),this.render()},render:function(){this.$el.html(this.template());var a=_.template($(".thumbnail-page-view-article-view-template").text()),b=Parse.Object.extend("Article"),c=new Parse.Query(b);return $(".thumbnail-post-title-button").click(function(){router.navigate("#detail",{trigger:!0})}),c.include("user"),c.ascending("createdAt"),c.find().done(function(b){window.fetchedArticles.reset(b),window.fetchedArticles.each(function(b){console.log(b),$(".thumbnail-columns").prepend(a({article:b}))})}),this}}),DetailView=Parse.View.extend({className:"detail-page",template:_.template($(".detail-page-view-template").text()),events:{},initialize:function(){$(".content-container").html(this.el),this.render()},render:function(){return this.$el.html(this.template(this.model.attributes)),$(".author-article-name").click(function(){router.navigate("#author",{trigger:!0})}),this}}),ProfileView=Parse.View.extend({className:"profile-page",template:_.template($(".profile-page-view-template").text()),events:{},initialize:function(){$(".content-container").html(this.el),this.render()},render:function(){this.$el.html(this.template());var a=Parse.User.current(),b=_.template($(".profile-page-article-template").text()),c=Parse.Object.extend("Article"),d=new Parse.Query(c);return $(".profile-article-name").click(function(){router.navigate("#detail",{trigger:!0})}),d.equalTo("user",a),d.ascending("createdAt"),d.find({success:function(a){a.forEach(function(a){console.log(a.attributes),$(".profile-user-container-right").prepend(b({post:a}))})},error:function(a){console.log(a)}}),this}}),AuthorView=Parse.View.extend({className:"author-page",template:_.template($(".author-page-view-template").text()),events:{"click .author-article-name":"seeDetailView"},initialize:function(){$(".content-container").html(this.el),this.render(),console.log(this.model)},render:function(){this.$el.html(this.template(this.model[0].attributes));var a=Parse.Object.extend("Article"),b=new Parse.Query(a),c=this.model[0].id;b.ascending("createdAt");var d={__type:"Pointer",className:"_User",objectId:c};return console.log(d),b.equalTo("user",d),b.find({success:function(a){console.log(a),a.forEach(function(a){console.log("article is id",a.id);var b=_.template($(".author-page-article-template").text()),c=b(a);$(".author-user-container-right").prepend(c)})},error:function(a){console.log(a)}}),this},seeDetailView:function(a){console.log(a.currentTarget.id);var b="/#detail/"+a.currentTarget.id;console.log(b),router.navigate(b,{trigger:!0})}}),AppRouter=Parse.Router.extend({routes:{"":"home",signUp:"signUp",signIn:"signIn",password:"password",settings:"settings",post:"post",thumbnail:"thumbnail","detail/:id":"detail",profile:"profile","author/:id":"author"},initialize:function(){window.fetchedArticles=new Articles},home:function(){checkNav(),$(".content-container").html("");new HomeView;console.log("HomeView has loaded.")},signUp:function(){checkNav(),$(".content-container").html("");new SignUpView;console.log("SignUpView has loaded.")},signIn:function(){checkNav(),$(".content-container").html("");new SignInView;console.log("SignInView has loaded.")},password:function(){checkNav(),$(".content-container").html("");new PasswordView;console.log("PasswordView has loaded.")},settings:function(){checkNav(),$(".content-container").html("");new SettingsView;console.log("SettingsView has loaded.")},post:function(){checkNav(),$(".content-container").html("");new PostView;console.log("PostView has loaded.")},thumbnail:function(){checkNav(),$(".content-container").html("");new ThumbnailView;console.log("ThumbnailView has loaded.")},detail:function(a){checkNav(),$(".content-container").html("");var b=window.fetchedArticles.get(a);if(console.log("article is ",b),b){new DetailView({model:b})}else{var c=new Parse.Query(Article);c.include("user"),c.get(a,{success:function(a){new DetailView({model:a})},error:function(){console.error("Page not found!")}})}console.log("DetailView has loaded.")},profile:function(){checkNav(),$(".content-container").html("");new ProfileView;console.log("ProfileView has loaded.")},author:function(a){checkNav(),$(".content-container").html(""),console.log(a);var b=new Parse.Query(Parse.User);console.log(a),b.equalTo("objectId",a),b.find({success:function(a){console.log("query results",a),new AuthorView({model:a}),console.log(a)},error:function(){console.error("Page not found!")}}),console.log("AuthorView has loaded.")}}),router=new AppRouter;Parse.history.start();